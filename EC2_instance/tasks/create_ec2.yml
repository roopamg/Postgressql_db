---
- name: Create EC2 instances
  ec2:
    key_name: "{{ key_name }}"
    region: "{{ region_name }}"
    instance_type: "{{ instance_type }}"
    image: "{{ ami_id }}"
    vpc_subnet_id: "{{ vpc_snid }}"
    group: default
    wait: yes
    instance_tags:
      Name: "{{ instance_name }}"
    count_tag:
      Name: "{{ instance_count_tag }}"
    exact_count: "{{ instance_count }}"
    assign_public_ip: yes
    aws_access_key: "{{ access_key }}"
    aws_secret_key: "{{ secret_key }}"
  become: yes
  register: ec2
